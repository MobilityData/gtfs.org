# Enable the rewrite engine
RewriteEngine On

# Redirect rules using regex
RedirectMatch 301 ^/schedule/reference/?$ /documentation/schedule/reference/
RedirectMatch 301 ^/schedule/best-practices/?$ /documentation/schedule/GTFS%20schedule%20best%20Practices/
RedirectMatch 301 ^/schedule/example-feed/?$ /getting_started/example_feed/
RedirectMatch 301 ^/schedule/examples/([^/]+)/?$ /documentation/schedule/examples/$1/
RedirectMatch 301 ^/schedule/examples/?$ /documentation/overview/
RedirectMatch 301 ^/schedule/changes/?$ /documentation/schedule/change_history/recent_additions/
RedirectMatch 301 ^/schedule/process/?$ /community/governance/gtfs_schedule_amendment_process/
RedirectMatch 301 ^/schedule/(validate|publishing)/?$ /getting_started/$1/
RedirectMatch 301 ^/realtime/best-practices/?$ /documentation/realtime/realtime_best_practices/
RedirectMatch 301 ^/realtime/feed-entities/?$ /documentation/realtime/feed_entities/overview/
RedirectMatch 301 ^/realtime/feed-entities/([^/]+)/?$ /documentation/realtime/feed_entities/$1/
RedirectMatch 301 ^/realtime/feed-examples/([^/]+)/?$ /documentation/realtime/examples/$1/
RedirectMatch 301 ^/realtime/feed-examples/?$ /documentation/overview/
RedirectMatch 301 ^/realtime/(proto|reference)/?$ /documentation/realtime/$1/
RedirectMatch 301 ^/realtime/changes/?$ /documentation/realtime/change_history/recent_additions/
RedirectMatch 301 ^/realtime/process/?$ /community/governance/gtfs_realtime_amendment_process/
RedirectMatch 301 ^/resources/community/?$ /community/get_involved/
RedirectMatch 301 ^/extensions/([^/]+)/?$ /community/extensions/$1/
RedirectMatch 301 ^/extensions/?$ /community/extensions/overview/

# Language bindings redirects
RewriteRule ^realtime/language-bindings/?$ /documentation/realtime/language-bindings/overview/ [L,R=301]
RewriteRule ^realtime/language-bindings/(.*)$ /documentation/realtime/language-bindings/$1 [L,R=301]

# Specific redirects for /resources/, /realtime/, and /schedule/
RewriteRule ^resources/?$ /resources/overview/ [L,R=301]
RewriteRule ^realtime/?$ /documentation/overview/ [L,R=301]
RewriteRule ^schedule/?$ /documentation/overview/ [L,R=301]

# Redirect /realtime/ to /documentation/overview/ only if the URL is exactly /realtime/
RewriteCond %{REQUEST_URI} ^/realtime/$
RewriteRule ^realtime/$ /documentation/overview/ [L,R=301]

# Redirect /realtime/reference/ to /documentation/realtime/reference/ only if the URL is exactly /realtime/reference/
RewriteCond %{REQUEST_URI} ^/realtime/reference/$
RewriteRule ^realtime/reference/$ /documentation/realtime/reference/ [L,R=301]

# Anchor redirections
RewriteRule ^realtime/process/#guiding-principles https://gtfs.org/community/governance/gtfs_realtime_amendment_process/#guiding-principles [R=301,NE]
RewriteRule ^realtime/process/#revision-history https://gtfs.org/documentation/realtime/change_history/revision_history/ [R=301]
RewriteRule ^realtime/process/#experimental-fields https://gtfs.org/community/governance/gtfs_realtime_amendment_process/#experimental-fields [R=301,NE]
RewriteRule ^#why-use-gtfs https://gtfs.org/getting_started/why_use_GTFS/ [R=301]
RewriteRule ^#what-is-high-quality-gtfs https://gtfs.org/getting_started/validate/ [R=301]
RewriteRule ^schedule/#getting-started https://gtfs.org/getting_started/create/ [R=301]
RewriteRule ^schedule/#training-resources https://gtfs.org/resources/overview/ [R=301]
RewriteRule ^schedule/#getting-help-community https://gtfs.org/community/get_involved/ [R=301]
RewriteRule ^schedule/process/#guiding-principles https://gtfs.org/community/governance/gtfs_schedule_amendment_process/#guiding-principles [R=301,NE]
RewriteRule ^schedule/process/#revision-history https://gtfs.org/documentation/schedule/change_history/revision_history/ [R=301]

# Match any URL trying to access the blog in anything but EN and redirect them to EN
RewriteCond %{REQUEST_URI} ^/(?:fr|es|ja|ru|pt|ko|id|de|zh|zh-TW)/blog/
RewriteRule ^(.+?)/.+$ /blog/ [L,R=302]

# Match any URL under /ja, /ru, /pt, /ko, /id, /de, /zh, or /zh-TW and redirect to the corresponding index.html
RewriteCond %{REQUEST_URI} ^/(ja|ru|pt|ko|id|de|zh|zh-TW)/
RewriteCond %{REQUEST_URI} !index\.html$
RewriteRule ^(.+?)/.+$ /$1/index.html [L,R=302]