#乗り換え

## ブロックトランスファー

ブロックトランスファー(座席内トランスファーとも呼ばれる) は、一連の旅行が次の条件を満たす場合に利用できます。

1. 旅行が連続している。

2. 両方の旅行を同じ車両が運行している。

3. 旅行は、交通フィードの [trips.txt](../../reference/#tripstxt) ファイルで同じ `block_id` 値を使用してプロビジョニングされている。

### ブロックトランスファーを有効にするには `block_id` を使用します 

ブロックトランスファーは、異なるルート・路線系統の連続する便間で行うことができます。`block_id` フィールドを使用して、どの便が 1 つのブロックに含まれるか、および座席内乗り換えが利用可能なオプションを指定します。

たとえば、次の [trips.txt](../../reference/#tripstxt) および [stop_times.txt](../../reference/#stop_timestxt) の値を検討します:

[**trips.txt**](../../reference/#tripstxt)

| route_id | trip_id     | block_id  |
|----------|-------------|---|
| RouteA   | RouteATrip1 |  Block1 |
| RouteB   | RouteBTrip1 |  Block1 |

[**stop_times.txt**](../../reference/#stop_timestxt)

| trip_id | arrival_time     | departure_time | stop_id | stop_sequence |
|----------|-------------|---|----|-----|
| RouteATrip1  | 12:00:00|  12:01:00 | A | 1 |
| RouteATrip1  | 12:05:00|  12:06:00 | B | 2 | 
| RouteATrip1 | 12:15:00 | | C | 3|
| RouteBTrip1 | | 12:18:00 | C | 1 |
| RouteBTrip1 |12:22:00 | 12:23:00 | D | 2 |
| RouteBTrip1 |12:30:00 |  | E | 3 | 

この例では、次のようになります。

- 停留所 A から停留所 E までのルートを検索するユーザーは、ルート A の 12:00 に停留所 A で乗車し、`RouteATrip1` の終了後に停留所 C に到着したら車両にとどまるように指示されます。これは、同じ車両がルート B の `RouteBTrip1` を運行しているためです。
- `RouteATrip1` に乗っていて、`RouteBTrip1` の停留所まで進みたい乗客は、この乗り換えの間、車両にとどまることができます。
- 同じルートを他の車両で移動する他の旅行の乗客は、旅行ごとに異なる車両を使用するため、このオプションはありません。

### ループ ラインでのブロック トランスファー

ループ ラインでは、旅行の最初の停留所と最後の停留所は同じで、同じ `stop_id` を持ちます。連続するループ旅行の `block_id` が同じであれば、ブロック トランスファーまたは座席内トランスファーが有効になり、最初の旅行の乗客は車両に留まり、次のループに進むことができます。